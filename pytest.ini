# pytest.ini - Pytest configuration file
# Chức năng: Cấu hình cho pytest test runner
# Định nghĩa các tùy chọn mặc định khi chạy tests

[pytest]
# Đường dẫn tìm test files
testpaths = tests

# Pattern để nhận diện test files
python_files = test_*.py *_test.py

# Pattern để nhận diện test classes
python_classes = Test*

# Pattern để nhận diện test functions
python_functions = test_*

# Các options mặc định khi chạy pytest
addopts = 
    # Hiển thị output verbose
    --verbose
    # Hiển thị local variables khi test fail
    --showlocals
    # Tính code coverage
    --cov=src
    # Format báo cáo coverage (terminal)
    --cov-report=term-missing
    # Format báo cáo coverage (HTML)
    --cov-report=html:htmlcov
    # Format báo cáo coverage (XML cho CI/CD)
    --cov-report=xml
    # Ngưỡng coverage tối thiểu (fail nếu dưới 85%)
    --cov-fail-under=85
    # Strict markers - fail nếu dùng marker không định nghĩa
    --strict-markers
    # Timeout mặc định cho mỗi test (seconds)
    --timeout=300
    # Hiển thị warnings
    --tb=short

# Markers tùy chỉnh
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests
    performance: marks tests as performance tests
    pbt: marks tests using property-based testing

# Các thư mục bỏ qua khi collect tests
norecursedirs = 
    .git
    .tox
    dist
    build
    *.egg
    venv
    env
    __pycache__

# Console output encoding
console_output_style = progress

# Minimum Python version
minversion = 7.0

# Log level
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Coverage options
[coverage:run]
source = src
omit = 
    */tests/*
    */test_*.py
    */__pycache__/*
    */venv/*
    */env/*

[coverage:report]
precision = 2
show_missing = true
skip_covered = false
